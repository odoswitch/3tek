{{ include('partials/main.html.twig') }}

<head>
    {{ include('partials/title-meta.html.twig', { title: 'Mes Favoris' }) }}
    {{ include('partials/head-css.html.twig') }}
</head>

<body>
    <div id="layout-wrapper">
        {{ include('partials/menu.html.twig') }}
        
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0"><i class="bx bx-heart me-2"></i>Mes Favoris</h4>
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="{{ path('app_dash') }}">Dashboard</a></li>
                                        <li class="breadcrumb-item active">Favoris</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="bx bx-check-circle me-2"></i> {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}

                    <div class="row">
                        {% if favoris is empty %}
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body text-center py-5">
                                        <i class="bx bx-heart font-size-48 text-muted mb-3"></i>
                                        <h5>Aucun favori</h5>
                                        <p class="text-muted">Vous n'avez pas encore ajouté de lots à vos favoris</p>
                                        <a href="{{ path('app_dash') }}" class="btn btn-primary">
                                            <i class="bx bx-store me-2"></i>Parcourir les lots
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            {% for favori in favoris %}
                            <div class="col-xl-4 col-sm-6 mb-4">
                                <div class="card h-100">
                                    <div class="position-relative">
                                        {% if favori.lot.images|length > 0 %}
                                            <img src="{{ vich_uploader_asset(favori.lot.images[0], 'imageFile') }}" 
                                                 alt="{{ favori.lot.name }}" 
                                                 class="img-fluid" 
                                                 style="height: 250px; object-fit: cover; width: 100%; {% if favori.lot.quantite == 0 %}opacity: 0.5; filter: grayscale(50%);{% endif %}">
                                            {% if favori.lot.quantite == 0 %}
                                                <div class="position-absolute top-50 start-50 translate-middle">
                                                    <span class="badge bg-danger font-size-16 px-3 py-2">
                                                        <i class="bx bx-x-circle"></i> RUPTURE DE STOCK
                                                    </span>
                                                </div>
                                            {% endif %}
                                            {% if favori.lot.images|length > 1 %}
                                                <span class="badge bg-primary position-absolute" style="top: 10px; right: 10px;">
                                                    <i class="bx bx-images"></i> {{ favori.lot.images|length }} photos
                                                </span>
                                            {% endif %}
                                        {% else %}
                                            <div class="text-center py-5 bg-light">
                                                <i class="bx bx-image font-size-48 text-muted"></i>
                                                <p class="text-muted mt-2">Aucune image</p>
                                            </div>
                                        {% endif %}
                                        <a href="{{ path('app_favori_remove', {id: favori.id}) }}" 
                                           class="btn btn-danger btn-sm position-absolute" 
                                           style="top: 10px; left: 10px;"
                                           onclick="return confirm('Retirer ce lot de vos favoris ?')">
                                            <i class="bx bxs-heart"></i>
                                        </a>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-2">
                                            <i class="bx bx-calendar"></i> <strong>Ajouté le :</strong> {{ favori.createdAt|date('d/m/Y') }}
                                        </p>
                                        <h5>
                                            <a href="{{ path('app_lot_view', {id: favori.lot.id}) }}" class="text-body">
                                                {{ favori.lot.name|upper }}
                                            </a>
                                        </h5>
                                        <p class="mb-0 font-size-15">
                                            {{ favori.lot.description|striptags|slice(0, 100) }}{% if favori.lot.description|length > 100 %}...{% endif %}
                                        </p>
                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h5 class="text-primary mb-0">{{ favori.lot.prix|number_format(2, ',', ' ') }} €</h5>
                                                <span class="badge {% if favori.lot.quantite > 10 %}bg-success{% elseif favori.lot.quantite > 0 %}bg-warning{% else %}bg-danger{% endif %}">
                                                    {% if favori.lot.quantite > 0 %}
                                                        <i class="bx bx-store"></i> Stock: {{ favori.lot.quantite }}
                                                    {% else %}
                                                        <i class="bx bx-x-circle"></i> Rupture de stock
                                                    {% endif %}
                                                </span>
                                            </div>
                                            <a href="{{ path('app_lot_view', {id: favori.lot.id}) }}" 
                                               class="btn btn-primary btn-sm w-100">
                                                <i class="bx bx-show me-1"></i> Voir les détails
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            {{ include('partials/footer.html.twig') }}
        </div>
    </div>

    {{ include('partials/right-sidebar.html.twig') }}
    {{ include('partials/vendor-scripts.html.twig') }}
    <script src="/js/app.js"></script>
</body>
</html>
